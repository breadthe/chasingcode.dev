<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="PHP 7.3 to 8.0 upgrade procedure on Ubuntu">

            <meta property="og:title" content="Upgrade PHP 7.4 to 8.0 on Ubuntu" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://chasingcode.dev/blog/upgrade-php-7-4-to-8-ubuntu"/>
    <meta property="og:description" content="PHP 7.3 to 8.0 upgrade procedure on Ubuntu" />

        
        <title>Upgrade PHP 7.4 to 8.0 on Ubuntu | Chasing Code</title>

        <link rel="home" href="https://chasingcode.dev">

        <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/favicons/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

        <link href="/blog/feed.atom" type="application/atom+xml" rel="alternate" title="Chasing Code Blog">

        

        <link rel="stylesheet" href="/assets/build/css/main.css?id=3824d15a7550cadd6feea53f638e89ad">
        <link href="https://github.com/breadthe" rel="me">
        <link rel="webmention" href="https://webmention.io/chasingcode.dev/webmention" />
        <link rel="pingback" href="https://webmention.io/chasingcode.dev/xmlrpc" />
    </head>

    <body class="flex flex-col justify-between bg-gray-50 text-grey-darkest leading-normal font-sans">

        <header class="flex items-center py-4" role="banner">
    <div class="container flex items-center max-w-6xl mx-auto px-4 lg:px-8">
        <div class="flex items-center">
            <a href="/" title="Chasing Code home" class="flex items-center justify-center gap-2 mr-2">
                <img width="48" height="48" src="/assets/images/chasingcode-logo.png" alt="Chasing Code logo" />

                <span class="text-xl leading-none font-bold text-teal-700">Chasing Code</span>
            </a>
        </div>

        <div id="vue-search" class="w-full flex justify-end items-center sm:gap-4">
                            <search
                    data-belongs-to-blog="1"
                ></search>
            
            <nav class="hidden sm:flex items-center justify-end gap-8 text-lg">
    <ul class="flex gap-4">
        <li>
    <a
        href=/blog
        class="text-teal-700 hover:text-teal-900 text-teal-900 underline underline-offset-4 decoration-4 decoration-teal-400"
    >Blog</a>
</li>

        <li>
    <a
        href=/archive
        class="text-teal-700 hover:text-teal-900"
    >Archive</a>
</li>

        <li>
    <a
        href=/games
        class="text-teal-700 hover:text-teal-900"
    >Games</a>
</li>

        <li>
    <a
        href=/uses
        class="text-teal-700 hover:text-teal-900"
    >Uses</a>
</li>

        <li>
    <a
        href=/about
        class="text-teal-700 hover:text-teal-900"
    >About</a>
</li>

        <li>
    <a
        href=/contact
        class="text-teal-700 hover:text-teal-900"
    >Contact</a>
</li>
    </ul>
</nav>

            <button class="flex justify-center items-center h-10 px-4 rounded-full sm:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current w-6 text-teal-400" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current w-6 text-teal-400" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

        </div>
    </div>
</header>

<nav id="js-nav-menu" class="hidden sm:hidden mb-4">
    <ul class="my-0 flex flex-col gap-4 px-4">
        <li>
    <a
        href=/blog
        class="text-teal-700 hover:text-teal-900 text-teal-900 underline underline-offset-4 decoration-4 decoration-teal-400"
    >Blog</a>
</li>

        <li>
    <a
        href=/archive
        class="text-teal-700 hover:text-teal-900"
    >Archive</a>
</li>

        <li>
    <a
        href=/games
        class="text-teal-700 hover:text-teal-900"
    >Games</a>
</li>

        <li>
    <a
        href=/uses
        class="text-teal-700 hover:text-teal-900"
    >Uses</a>
</li>

        <li>
    <a
        href=/about
        class="text-teal-700 hover:text-teal-900"
    >About</a>
</li>

        <li>
    <a
        href=/contact
        class="text-teal-700 hover:text-teal-900"
    >Contact</a>
</li>
    </ul>
</nav>

        <main
            role="main"
            class="flex-auto w-full max-w-2xl mx-auto"
        >
            
                <article class="p-4 sm:p-6 bg-white rounded">
        <header class="mb-2">
            
            <h1 class="font-serif text-3xl mb-1 md:mb-2">Upgrade PHP 7.4 to 8.0 on Ubuntu</h1>

            <div class="flex flex-col md:flex-row gap-2">
                <small class="font-mono">
                    by <a href="/about">webmaster</a>
                </small>

                <small class="hidden md:block">&bull;</small>

                <small class="font-mono">
                    2021-03-05
                </small>

                
                <small class="hidden md:block">&bull;</small>

                <small class="flex flex-wrap gap-2">
                    <a
        href="/blog/tags/php"
        title=" posts in View posts in #php"
        class="category--tag font-mono font-light text-teal-700"
        >
    #php
</a>
                    <a
        href="/blog/tags/linux"
        title=" posts in View posts in #linux"
        class="category--tag font-mono font-light text-teal-700"
        >
    #linux
</a>
            </small>
            </div>

                    </header>

        <div class="post font-light text-gray-900 tracking-wide pb-4" v-pre>
            <p>I host several websites on a Linode VPS, originally provisioned with Laravel Forge. I have long since canceled my Forge subscription, and I do my own maintenance, manually. I may not be the quickest to upgrade to the latest version of anything, but I will do it eventually.</p>

<p>As an indie maker with zero revenue from my side projects, it wasn't making financial sense to pay for Forge. The biggest value Forge brought me was the initial provisioning of the instance. Afterwards, I continued to deploy code manually (how hard can <code>git pull</code> be?), and do my own basic server maintenance. I've been doing this successfully for the better part of the last 2 years.</p>

<p>This guide is about upgrading from PHP 7.4 to 8.0 on Ubuntu 18.04. As of this writing, I have yet to upgrade to Ubuntu 20.04, but it will happen soon(ish).</p>

<p>The instructions are partly based on this excellent <a href="https://php.watch/articles/php-8.0-installation-update-guide-debian-ubuntu">article</a>, but I've added many specifics, details, and pitfalls I encountered in my own situation. It wasn't exactly smooth sailing, as you'll see.</p>

<h2>Prep</h2>

<p>SSH into the instance, then...</p>

<pre><code class="language-bash"># Check PHP version
php -v
PHP 7.4.15 (cli) (built: Feb 23 2021 15:12:05) ( NTS )
Copyright (c) The PHP Group
Zend Engine v3.4.0, Copyright (c) Zend Technologies
    with Zend OPcache v7.4.15, Copyright (c), by Zend Technologies

# List all PHP packages
dpkg -l | grep php | tee packages.txt

# List
ii  php-common                             2:81+ubuntu18.04.1+deb.sury.org+1                                  all          Common files for PHP packages
ii  php-igbinary                           3.2.1+2.0.8-6+ubuntu18.04.1+deb.sury.org+1                         amd64        igbinary PHP serializer
ii  php-memcached                          3.1.5+2.2.0-9+ubuntu18.04.1+deb.sury.org+1                         amd64        memcached extension module for PHP, uses libmemcached
ii  php-msgpack                            2.1.2+0.5.7-6+ubuntu18.04.1+deb.sury.org+1                         amd64        PHP extension for interfacing with MessagePack
ii  php-pear                               1:1.10.12+submodules+notgz+20210212-1+ubuntu18.04.1+deb.sury.org+1 all          PEAR Base System
ii  php7.4-bcmath                          7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        Bcmath module for PHP
ii  php7.4-cli                             7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        command-line interpreter for the PHP scripting language
ii  php7.4-common                          7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        documentation, examples and common module for PHP
ii  php7.4-curl                            7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        CURL module for PHP
ii  php7.4-dev                             7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        Files for PHP7.4 module development
ii  php7.4-fpm                             7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        server-side, HTML-embedded scripting language (FPM-CGI binary)
ii  php7.4-gd                              7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        GD module for PHP
ii  php7.4-igbinary                        3.2.1+2.0.8-6+ubuntu18.04.1+deb.sury.org+1                         amd64        igbinary PHP serializer
ii  php7.4-imap                            7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        IMAP module for PHP
ii  php7.4-intl                            7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        Internationalisation module for PHP
ii  php7.4-json                            7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        JSON module for PHP
ii  php7.4-mbstring                        7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        MBSTRING module for PHP
rc  php7.4-memcached                       3.1.5+2.2.0-9+ubuntu18.04.1+deb.sury.org+1                         amd64        memcached extension module for PHP, uses libmemcached
ii  php7.4-msgpack                         2.1.2+0.5.7-6+ubuntu18.04.1+deb.sury.org+1                         amd64        PHP extension for interfacing with MessagePack
ii  php7.4-mysql                           7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        MySQL module for PHP
ii  php7.4-opcache                         7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        Zend OpCache module for PHP
ii  php7.4-pgsql                           7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        PostgreSQL module for PHP
ii  php7.4-readline                        7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        readline module for PHP
ii  php7.4-soap                            7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        SOAP module for PHP
ii  php7.4-sqlite3                         7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        SQLite3 module for PHP
ii  php7.4-xml                             7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        DOM, SimpleXML, XML, and XSL module for PHP
ii  php7.4-zip                             7.4.15-7+ubuntu18.04.1+deb.sury.org+1                              amd64        Zip module for PHP
ii  php8.0-common                          8.0.2-7+ubuntu18.04.1+deb.sury.org+1                               amd64        documentation, examples and common module for PHP
ii  php8.0-igbinary                        3.2.1+2.0.8-6+ubuntu18.04.1+deb.sury.org+1                         amd64        igbinary PHP serializer
ii  php8.0-memcached                       3.1.5+2.2.0-9+ubuntu18.04.1+deb.sury.org+1                         amd64        memcached extension module for PHP, uses libmemcached
ii  php8.0-msgpack                         2.1.2+0.5.7-6+ubuntu18.04.1+deb.sury.org+1                         amd64        PHP extension for interfacing with MessagePack
ii  pkg-php-tools                          1.35ubuntu1                                                        all          various packaging tools and scripts for PHP packages
</code></pre>

<h2>Add PPAs</h2>

<pre><code class="language-bash"># Add ondrej/php PPA
sudo add-apt-repository ppa:ondrej/php # Press enter when prompted.
# CAVEATS:
# 1. If you are using php-gearman, you need to add ppa:ondrej/pkg-gearman
# 2. If you are using apache2, you are advised to add ppa:ondrej/apache2
# 3. If you are using nginx, you are advised to add ppa:ondrej/nginx-mainline or ppa:ondrej/nginx

sudo add-apt-repository ppa:ondrej/nginx

# Remove a repository (not needed here, listed for reference)
# sudo add-apt-repository --remove ppa:ondrej/nginx

# Check if PPA was added - should see a number of entries
grep ^ /etc/apt/sources.list /etc/apt/sources.list.d/* | grep ondrej/php
grep ^ /etc/apt/sources.list /etc/apt/sources.list.d/* | grep ondrej/nginx

sudo apt-get update
</code></pre>

<h2>Install PHP 8.0</h2>

<pre><code class="language-bash">sudo apt install php8.0-common php8.0-cli -y

# Check version
php -v
PHP 8.0.2 (cli) (built: Feb 23 2021 15:13:59) ( NTS )
Copyright (c) The PHP Group
Zend Engine v4.0.2, Copyright (c) Zend Technologies
    with Zend OPcache v8.0.2, Copyright (c), by Zend Technologies

# Check modules (each will appear on its own line, listed on a single line here for brevity)
php -m
[PHP Modules] calendar Core ctype date exif FFI fileinfo filter ftp gettext hash iconv igbinary json libxml memcached msgpack openssl pcntl pcre PDO Phar posix readline Reflection session shmop sockets sodium SPL standard sysvmsg sysvsem sysvshm tokenizer Zend OPcache zlib
[Zend Modules]
Zend OPcache

# Install additional extensions that were present in 7.4
# Note: no need to install php8.0-json; it's already provided by other packages  
sudo apt install php8.0-{bcmath,curl,dev,fpm,gd,igbinary,imap,intl,mbstring,memcached,msgpack,mysql,opcache,pgsql,readline,soap,sqlite3,xml,zip}
</code></pre>

<h2>Cleanup</h2>

<p>Since I won't be using old versions of PHP (&lt; 7.4), now is a good time to remove them.</p>

<pre><code class="language-bash"># Purge old packages, in my case from PHP 5.6 thru 7.3
sudo apt purge '^php5.6.*'
sudo apt purge '^php7.0.*'
sudo apt purge '^php7.1.*'
sudo apt purge '^php7.2.*'
sudo apt purge '^php7.3.*'
</code></pre>

<h2>Update Nginx config for each site</h2>

<p>This is for Nginx servers only. Sorry, I can't help you with Apache.</p>

<p>Repeat the procedure for each site. There's a way to automate it, probably with <code>sed</code> but I don't do this often enough to warrant the</p>

<pre><code class="language-bash">sudo vi /etc/nginx/sites-enabled/example.com

# Look for the following block
location ~ \.php$ {
    fastcgi_split_path_info ^(.+\.php)(/.+)$;
    fastcgi_pass unix:/var/run/php/php7.4-fpm.sock; # change to php8.0-fpm.sock or even better to php8.0-fpm.sock
    fastcgi_index index.php;
    include fastcgi_params;
}

# Test Nginx config
sudo nginx -t
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful

# Restart PHP FPM &amp; Nginx
sudo service php8.0-fpm restart
sudo service nginx restart
</code></pre>

<p><strong>Note</strong> The reason I recommend using the generic <code>php-fpm.sock</code> instead of <code>php8.0-fpm.sock</code>  is because, on my server at least, <code>php-fpm.sock</code> is actually aliased to <code>php8.0-fpm.sock</code>. Run these commands to find out:</p>

<pre><code class="language-bash">ls -al /var/run/php/php-fpm.sock # /var/run/php/php-fpm.sock -&gt; /etc/alternatives/php-fpm.sock
ls -al /etc/alternatives/php-fpm.sock # /etc/alternatives/php-fpm.sock -&gt; /run/php/php8.0-fpm.sock
</code></pre>

<p>I don't know the specifics of why it is so, but I assume it was done as part of the PHP 8 upgrade, which works really well for me as I don't have to worry about changing the Nginx config the next time I upgrade PHP.</p>

<h2>Composer install errors?</h2>

<p>Let's say that, after upgrading PHP to the shiny new 8.0, you want to run <code>composer install --no-interaction --prefer-dist --optimize-autoloader</code> in your Laravel project, and see the following errors:</p>

<pre><code class="language-bash">Deprecation Notice: Required parameter $path follows optional parameter $schema in phar:///usr/local/bin/composer/vendor/justinrainbow/json-schema/src/JsonSchema/Constraints/UndefinedConstraint.php:62
Deprecation Notice: Required parameter $path follows optional parameter $schema in phar:///usr/local/bin/composer/vendor/justinrainbow/json-schema/src/JsonSchema/Constraints/UndefinedConstraint.php:108
Deprecation Notice: Method ReflectionParameter::getClass() is deprecated in phar:///usr/local/bin/composer/src/Composer/Repository/RepositoryManager.php:130
Deprecation Notice: Method ReflectionParameter::getClass() is deprecated in phar:///usr/local/bin/composer/src/Composer/Repository/RepositoryManager.php:130
Loading composer repositories with package information
Installing dependencies (including require-dev) from lock file
PHP Fatal error:  Uncaught ArgumentCountError: array_merge() does not accept unknown named parameters in phar:///usr/local/bin/composer/src/Composer/DependencyResolver/DefaultPolicy.php:84
Stack trace:
#0 [internal function]: array_merge()
#1 phar:///usr/local/bin/composer/src/Composer/DependencyResolver/DefaultPolicy.php(84): call_user_func_array()
#2 phar:///usr/local/bin/composer/src/Composer/DependencyResolver/Solver.php(387): Composer\DependencyResolver\DefaultPolicy-&gt;selectPreferredPackages()
#3 phar:///usr/local/bin/composer/src/Composer/DependencyResolver/Solver.php(740): Composer\DependencyResolver\Solver-&gt;selectAndInstall()
#4 phar:///usr/local/bin/composer/src/Composer/DependencyResolver/Solver.php(231): Composer\DependencyResolver\Solver-&gt;runSat()
#5 phar:///usr/local/bin/composer/src/Composer/Installer.php(489): Composer\DependencyResolver\Solver-&gt;solve()
#6 phar:///usr/local/bin/composer/src/Composer/Installer.php(232): Composer\Installer-&gt;doInstall()
#7 phar:///usr/local/bin/composer/src/Composer/Command/InstallCommand.php(122): Composer\Installer-&gt;run()
#8 phar:///usr/local/bin/composer/vendor/symfony/console/Command/Command.php(245): Composer\Command\InstallCommand-&gt;execute()
#9 phar:///usr/local/bin/composer/vendor/symfony/console/Application.php(835): Symfony\Component\Console\Command\Command-&gt;run()
#10 phar:///usr/local/bin/composer/vendor/symfony/console/Application.php(185): Symfony\Component\Console\Application-&gt;doRunCommand()
#11 phar:///usr/local/bin/composer/src/Composer/Console/Application.php(281): Symfony\Component\Console\Application-&gt;doRun()
#12 phar:///usr/local/bin/composer/vendor/symfony/console/Application.php(117): Composer\Console\Application-&gt;doRun()
#13 phar:///usr/local/bin/composer/src/Composer/Console/Application.php(113): Symfony\Component\Console\Application-&gt;run()
#14 phar:///usr/local/bin/composer/bin/composer(61): Composer\Console\Application-&gt;run()
#15 /usr/local/bin/composer(24): require('...')
#16 {main}
  thrown in phar:///usr/local/bin/composer/src/Composer/DependencyResolver/DefaultPolicy.php on line 84

Fatal error: Uncaught ArgumentCountError: array_merge() does not accept unknown named parameters in phar:///usr/local/bin/composer/src/Composer/DependencyResolver/DefaultPolicy.php:84
Stack trace:
#0 [internal function]: array_merge()
#1 phar:///usr/local/bin/composer/src/Composer/DependencyResolver/DefaultPolicy.php(84): call_user_func_array()
#2 phar:///usr/local/bin/composer/src/Composer/DependencyResolver/Solver.php(387): Composer\DependencyResolver\DefaultPolicy-&gt;selectPreferredPackages()
#3 phar:///usr/local/bin/composer/src/Composer/DependencyResolver/Solver.php(740): Composer\DependencyResolver\Solver-&gt;selectAndInstall()
#4 phar:///usr/local/bin/composer/src/Composer/DependencyResolver/Solver.php(231): Composer\DependencyResolver\Solver-&gt;runSat()
#5 phar:///usr/local/bin/composer/src/Composer/Installer.php(489): Composer\DependencyResolver\Solver-&gt;solve()
#6 phar:///usr/local/bin/composer/src/Composer/Installer.php(232): Composer\Installer-&gt;doInstall()
#7 phar:///usr/local/bin/composer/src/Composer/Command/InstallCommand.php(122): Composer\Installer-&gt;run()
#8 phar:///usr/local/bin/composer/vendor/symfony/console/Command/Command.php(245): Composer\Command\InstallCommand-&gt;execute()
#9 phar:///usr/local/bin/composer/vendor/symfony/console/Application.php(835): Symfony\Component\Console\Command\Command-&gt;run()
#10 phar:///usr/local/bin/composer/vendor/symfony/console/Application.php(185): Symfony\Component\Console\Application-&gt;doRunCommand()
#11 phar:///usr/local/bin/composer/src/Composer/Console/Application.php(281): Symfony\Component\Console\Application-&gt;doRun()
#12 phar:///usr/local/bin/composer/vendor/symfony/console/Application.php(117): Composer\Console\Application-&gt;doRun()
#13 phar:///usr/local/bin/composer/src/Composer/Console/Application.php(113): Symfony\Component\Console\Application-&gt;run()
#14 phar:///usr/local/bin/composer/bin/composer(61): Composer\Console\Application-&gt;run()
#15 /usr/local/bin/composer(24): require('...')
#16 {main}
  thrown in phar:///usr/local/bin/composer/src/Composer/DependencyResolver/DefaultPolicy.php on line 84
</code></pre>

<p>Oops, apparently I completely forgot that my server still runs Composer 1.0, while my local environment was upgraded to 2.0 a long time ago. Time to upgrade the server too.</p>

<h2>Upgrade Composer from 1.0 to 2.0</h2>

<p>This <a href="https://blog.laravel.com/upgrading-to-composer-v2">article</a> partially covers the procedure, but here are my own steps:</p>

<pre><code class="language-bash"># Check version
composer --version
Composer version 1.10.1 2020-03-13 20:34:27

# Upgrade Composer to 2.0
sudo composer self-update

# Downgrade Composer to 1.0 (in case you need it)
# sudo composer self-update --rollback # return to version 1.10.1

# Check version
composer --version
Composer version 2.0.11 2021-02-24 14:57:23
</code></pre>

<p><code>composer install</code> should once again work without issues.</p>

<h2>500 Internal Server Error</h2>

<p>Everything looks fine and dandy, right? Not so fast. There's always a final wrench in the proverbial gears. You may not encounter this specific issue, but it's absolutely worth documenting.</p>

<p>When I loaded one of my main Laravel sites in the browser, I was presented with a nice blank page (production client reporting is off as it should be), but with a <code>500 Internal Server Error</code> in the dev console. So let's tail the Nginx app log to see what is going on, using <code>tail -f /var/log/nginx/example.com-error.log</code>:</p>

<pre><code class="language-bash">2021/03/05 06:42:09 [error] 836#836: *1 FastCGI sent in stderr: "PHP message: PHP Fatal error:  Uncaught ErrorException: file_put_contents(/home/forge/example.com/storage/framework/views/2e31adb7dfd4e14cc6108d8b49272e43adaa7371.php): Failed to open stream: Permission denied in /home/forge/example.com/vendor/laravel/framework/src/Illuminate/Filesystem/Filesystem.php:135
Stack trace:
#0 [internal function]: Illuminate\Foundation\Bootstrap\HandleExceptions-&gt;handleError()
#1 /home/forge/example.com/vendor/laravel/framework/src/Illuminate/Filesystem/Filesystem.php(135): file_put_contents()
#2 /home/forge/example.com/vendor/laravel/framework/src/Illuminate/View/Compilers/BladeCompiler.php(150): Illuminate\Filesystem\Filesystem-&gt;put()
#3 /home/forge/example.com/vendor/laravel/framework/src/Illuminate/View/Engines/CompilerEngine.php(51): Illuminate\View\Compilers\BladeCompiler-&gt;compile()
#4 /home/forge/example.com/vendor/facade/ignition/src/Views/Engines/CompilerEngine.php(37): Illuminate\View\Engines\CompilerEngine-&gt;get()
#5 /home/forge/example.com/vendor/laravel/fram...PHP message: PHP Fatal error:  Uncaught ErrorException: file_put_contents(/home/forge/example.com/storage/framework/views/2e31adb7dfd4e14cc6108d8b49272e43adaa7371.php): Failed to open stream: Permission denied in /home/forge/example.com/vendor/laravel/framework/src/Illuminate/Filesystem/Filesystem.php:135
Stack trace:
#0 [internal function]: Illuminate\Foundation\Bootstrap\HandleExceptions-&gt;handleError()
#1 /home/forge/example.com/vendor/laravel/framework/src/Illuminate/Filesystem/Filesystem.php(135): file_put_contents()
#2 /home/forge/example.com/vendor/laravel/framework/src/Illuminate/View/Compilers/BladeCompiler.php(150): Illuminate\Filesystem\Filesystem-&gt;put()
#3 /home/forge/example.com/vendor/laravel/framework/src/Illuminate/View/Engines/CompilerEngine.php(51): Illuminate\View\Compilers\BladeCompiler-&gt;compile()
#4 /home/forge/example.com/vendor/facade/ignition/src/Views/Engines/CompilerEngine.php(37): Illuminate\View\Engines\CompilerEngine-&gt;get()
</code></pre>

<p>At first glance it looks like Laravel doesn't have permissions to write to the <code>storage/</code> folder.</p>

<p>After some digging, I realized that ownership and permissions for the <code>storage/</code> folder have changed for some reason. I seem to recall a similar situation from a couple of years back.</p>

<p>An easy way to find if permissions are out of whack is to compare with another site that still works. Right away I noticed that the sub-folders in <code>storage/</code> had <code>755</code> permissions instead of <code>775</code>.</p>

<pre><code class="language-bash"># Before 755
ls -al /home/forge/example.com/storage/framework/
total 76
drwxr-xr-x 6 forge forge  4096 Mar  5 07:00 .
drwxr-xr-x 6 forge forge  4096 Aug 23  2019 ..
drwxr-xr-x 3 forge forge  4096 Aug 23  2019 cache
-rwxr-xr-x 1 forge forge   103 Aug 23  2019 .gitignore
drwxr-xr-x 2 forge forge 40960 Mar  5 06:16 sessions
drwxr-xr-x 2 forge forge  4096 Aug 23  2019 testing
drwxr-xr-x 2 forge forge 12288 Mar  5 06:37 views

# Recursively fix ownership and permissions 
sudo chown -R forge:www-data storage
sudo chmod -R ug+w storage

# After 775
ls -al /home/forge/example.com/storage/framework/
total 48
drwxrwxr-x 6 forge forge  4096 Jan 19  2020 .
drwxrwxr-x 5 forge forge  4096 Jan 19  2020 ..
drwxrwxr-x 3 forge forge  4096 Jan 19  2020 cache
-rwxrwxr-x 1 forge forge   103 Jan 19  2020 .gitignore
drwxr-xr-x 2 forge forge 40960 Mar  5 06:16 sessions
drwxrwxr-x 2 forge forge  4096 Jan 19  2020 testing
drwxr-xr-x 2 forge forge 12288 Mar  5 06:37 views

php artisan cache:clear
composer dumpautoload
sudo service nginx restart
# OK
</code></pre>

<h2>The end</h2>

<p>This concludes the PHP 7.4 -> 8.0 upgrade. All systems are green. Lessons were learned.</p>

            <section class="mt-8">
    <div class="font-semibold">
        Liked this article? Share it on your favorite platform.
    </div>

    <div class="mt-2 flex flex-wrap gap-2">
        <a href="javascript:void(0);"
                id="mastodon-share"
                data-src="PHP 7.3 to 8.0 upgrade procedure on Ubuntu&amp;url=https://chasingcode.dev/blog/upgrade-php-7-4-to-8-ubuntu"
                class="bg-mastodon-purple social--share--icon no-underline text-white hover:text-white rounded font-mono px-2 py-1"
        >Mastodon</a>

        <a href="https://twitter.com/share?url=https://chasingcode.dev/blog/upgrade-php-7-4-to-8-ubuntu&text=PHP 7.3 to 8.0 upgrade procedure on Ubuntu&via=brbcoding"
           style="background: #55acee;"
           class="social--share--icon no-underline text-white hover:text-white rounded font-mono px-2 py-1"
        >Twitter</a>

        <a href="https://www.facebook.com/sharer/sharer.php?u=https://chasingcode.dev/blog/upgrade-php-7-4-to-8-ubuntu"
           style="background: #3B5998;"
           class="social--share--icon no-underline text-white hover:text-white rounded font-mono px-2 py-1"
        >Facebook</a>

        <a href="https://reddit.com/submit?url=https://chasingcode.dev/blog/upgrade-php-7-4-to-8-ubuntu&title=Upgrade PHP 7.4 to 8.0 on Ubuntu"
           style="background: #ff5700;"
           class="social--share--icon no-underline text-white hover:text-white rounded font-mono px-2 py-1"
        >Reddit</a>

        <a href="https://news.ycombinator.com/submitlink?u=https://chasingcode.dev/blog/upgrade-php-7-4-to-8-ubuntu&t=Upgrade PHP 7.4 to 8.0 on Ubuntu"
           style="background: #ff6600;"
           class="social--share--icon no-underline text-white hover:text-white rounded font-mono px-2 py-1"
        >Hacker News</a>

        <a href="https://www.linkedin.com/shareArticle?url=https://chasingcode.dev/blog/upgrade-php-7-4-to-8-ubuntu&title=Upgrade PHP 7.4 to 8.0 on Ubuntu&summary=PHP 7.3 to 8.0 upgrade procedure on Ubuntu&source=https://chasingcode.dev"
           style="background: #4875B4;"
           class="social--share--icon no-underline text-white hover:text-white rounded font-mono px-2 py-1"
        >LinkedIn</a>

        <a href="mailto:?subject=Upgrade PHP 7.4 to 8.0 on Ubuntu&body=https://chasingcode.dev/blog/upgrade-php-7-4-to-8-ubuntu"
           style="background: #444444;"
           class="social--share--icon no-underline text-white hover:text-white rounded font-mono px-2 py-1"
        >Email</a>
    </div>
</section>

<script>
    // @see https://www.bentasker.co.uk/posts/documentation/general/adding-a-share-on-mastodon-button-to-a-website.html
    doDocumentReady(enableMastodonShare);

    /* Generate a share link for the user's Mastodon domain */
    function mastodonShare(e) {

        // Get the source text
        const src = e.target.getAttribute("data-src");

        // Get the Mastodon domain
        const domain = prompt("Enter your Mastodon domain (enable browser pop-ups)", "mastodon.social");

        if (domain === "" || domain == null) {
            return;
        }

        // Build the URL
        const url = "https://" + domain + "/share?text=" + src;

        // Open a window on the share page
        window.open(url, '_blank');
    }

    function doDocumentReady(fn) {
        if (document.readyState === "complete" ||
            (document.readyState !== "loading" && !document.documentElement.doScroll)
        ) {
            fn();
        } else {
            document.addEventListener("DOMContentLoaded", fn);
        }
    }

    function enableMastodonShare() {
        document.getElementById('mastodon-share').addEventListener('click', mastodonShare);
    }
</script>        </div>

        <section id="mastodon-webmention">
    <mastodon-webmention page-url="https://chasingcode.dev/blog/upgrade-php-7-4-to-8-ubuntu" mastodon-toot-url=""></mastodon-webmention>
</section>

        

        <nav class="flex justify-between text-sm md:text-base my-4 sm:mb-0">
            <div>
                                    <a href="https://chasingcode.dev/blog/ode-to-the-mac" class="no-underline" title="Older Post: Ode to the Mac">
                        &LeftArrow; Ode to the Mac
                    </a>
                            </div>

            <div>
                                    <a href="https://chasingcode.dev/blog/deploy-svelte-to-netlify" class="no-underline" title="Newer Post: How to Deploy Svelte to Netlify">
                        How to Deploy Svelte to Netlify &RightArrow;
                    </a>
                            </div>
        </nav>
    </article>
        </main>

        <footer class="flex flex-col gap-4 max-w-2xl m-8 sm:mx-auto text-center">
    <div class="w-full flex flex-row justify-center gap-4">
        <a href="/blog/feed.atom" class="group w-full flex flex-col items-center justify-center gap-2">
            <span class="group-hover:text-teal-400">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5 0 0 0-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
                </svg>
            </span>
            <span class="group-hover:text-teal-400">RSS</span>
        </a>

        <a href="https://indieweb.social/@brbcoding" class="group w-full flex flex-col items-center justify-center gap-2">
            <span class="group-hover:text-teal-400">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a4 4 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522q0-1.288.66-2.046c.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764q.662.757.661 2.046z"/>
                </svg>
            </span>
            <span class="group-hover:text-teal-400">Mastodon</span>
        </a>

        <a href="https://twitter.com/brbcoding" class="group w-full flex flex-col items-center justify-center gap-2">
            <span class="group-hover:text-teal-400">
                <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-twitter"
>
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg>
            </span>
            <span class="group-hover:text-teal-400">Twitter</span>
        </a>

        <a href="https://github.com/breadthe" class="group w-full flex flex-col items-center justify-center gap-2">
            <span class="group-hover:text-teal-400">
                <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-github"
>
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
            </span>
            <span class="group-hover:text-teal-400">Github</span>
        </a>
    </div>
    <small class="italic opacity-60">
        2018-2024 🦄&nbsp; All content & opinions my own
    </small>
</footer>

        <script src="/assets/build/js/main.js?id=e27301064934efeda72c2d9e59dcaac9" async></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>
    </body>
</html>
